{
  "editable": true,
  "schemaVersion": 38,
  "title": "Iris ML Executive: Ultimate Insights",
  "uid": "iris_ml_dashboard",
  "version": 3,
  "panels": [
    {
      "title": "Row: Model Operational Health",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },
    {
      "title": "Current Inference Velocity",
      "type": "gauge",
      "gridPos": { "h": 7, "w": 6, "x": 0, "y": 1 },
      "targets": [{ "expr": "sum(rate(iris_predictions_total[$__rate_interval]))" }],
      "fieldConfig": {
        "defaults": { "unit": "reqps", "color": { "mode": "gradient" }, "max": 100 }
      }
    },
    {
      "title": "Class Balance Trend (Dynamic Resolution)",
      "type": "timeseries",
      "gridPos": { "h": 7, "w": 18, "x": 6, "y": 1 },
      "description": "Smooth throughput using $__rate_interval to prevent point overflow.",
      "targets": [
        {
          "expr": "sum by (species) (rate(iris_predictions_total[$__rate_interval]))",
          "legendFormat": "{{species}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 15, "gradientMode": "opacity" },
          "unit": "reqps"
        }
      }
    },
    {
      "title": "Row: Model Stability (PSI Analysis)",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 8 }
    },
    {
      "title": "Instant PSI (5m vs 5m Offset 1h)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 9 },
      "description": "Compares last 5m to the same window 1 hour ago.",
      "targets": [
        {
          "expr": "sum by (feature_name) ( ( (rate(iris_feature_values_cm_bucket[5m]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[5m]) + 0.0001)) - (rate(iris_feature_values_cm_bucket[5m] offset 1h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[5m] offset 1h) + 0.0001)) ) * ln( (rate(iris_feature_values_cm_bucket[5m]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[5m]) + 0.0001)) / (rate(iris_feature_values_cm_bucket[5m] offset 1h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[5m] offset 1h) + 0.0001)) ) )",
          "legendFormat": "Instant PSI: {{feature_name}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20 },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 0.1 }, { "color": "red", "value": 0.25 }] }
        }
      }
    },
    {
      "title": "Mid-Term PSI (1h vs 1h Offset 6h)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 9 },
      "description": "Compares last hour to 6 hours ago baseline.",
      "targets": [
        {
          "expr": "sum by (feature_name) ( ( (rate(iris_feature_values_cm_bucket[1h]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[1h]) + 0.0001)) - (rate(iris_feature_values_cm_bucket[1h] offset 6h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[1h] offset 6h) + 0.0001)) ) * ln( (rate(iris_feature_values_cm_bucket[1h]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[1h]) + 0.0001)) / (rate(iris_feature_values_cm_bucket[1h] offset 6h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[1h] offset 6h) + 0.0001)) ) )",
          "legendFormat": "Mid-Term PSI: {{feature_name}}"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 10 } }
      }
    },
    {
      "title": "Long-Term PSI (6h vs 6h Offset 24h)",
      "type": "gauge",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 9 },
      "description": "Macro drift over a full day cycle.",
      "targets": [
        { "expr": "max(sum by (feature_name) ( ( (rate(iris_feature_values_cm_bucket[6h]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[6h]) + 0.0001)) - (rate(iris_feature_values_cm_bucket[6h] offset 24h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[6h] offset 24h) + 0.0001)) ) * ln( (rate(iris_feature_values_cm_bucket[6h]) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[6h]) + 0.0001)) / (rate(iris_feature_values_cm_bucket[6h] offset 24h) / ignoring(le) group_left(feature_name) sum by (feature_name) (rate(iris_feature_values_cm_bucket[6h] offset 24h) + 0.0001)) ) ))" }
      ],
      "fieldConfig": {
        "defaults": { "min": 0, "max": 0.5, "thresholds": { "steps": [{ "color": "green", "value": 0 }, { "color": "#EAB839", "value": 0.1 }, { "color": "red", "value": 0.25 }] } }
      }
    },
    {
      "title": "Row: Data Science & Drift Insights",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }
    },
    {
      "title": "Feature Value Distribution (Viridis)",
      "type": "heatmap",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 18 },
      "targets": [{ "expr": "sum by (le) (rate(iris_feature_values_cm_bucket[$__rate_interval]))", "format": "heatmap" }],
      "options": { "color": { "mode": "scheme", "scheme": "Viridis" }, "calculate": false }
    },
    {
      "title": "Feature Distribution (Spectral)",
      "type": "heatmap",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 18 },
      "targets": [{ "expr": "sum by (le) (rate(iris_feature_values_cm_bucket[$__rate_interval]))", "format": "heatmap" }],
      "options": { "color": { "mode": "scheme", "scheme": "Spectral" }, "calculate": false }
    },
    {
      "title": "Row: Feature Mean Stability",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 26 }
    },
    {
      "title": "Mean Stability (Rolling)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 27 },
      "targets": [{ "expr": "iris_feature_values_cm_sum / iris_feature_values_cm_count", "legendFormat": "Mean: {{feature_name}}" }],
      "fieldConfig": { "defaults": { "custom": { "lineInterpolation": "smooth" }, "unit": "lengthcm" } }
    },
    {
      "title": "Row: Business Impact & Efficiency",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 35 }
    },
    {
      "title": "Cumulative Growth (Range Total)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 36 },
      "targets": [
        { "expr": "increase(iris_predictions_total[$__range])", "legendFormat": "Total {{species}}" }
      ],
      "fieldConfig": { "defaults": { "custom": { "drawStyle": "bars", "fillOpacity": 80 } } }
    },
    {
      "title": "System Confidence Proxy",
      "type": "stat",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 36 },
      "targets": [{ "expr": "avg(rate(iris_predictions_total[$__rate_interval]))" }],
      "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "unit": "none" } }
    }
  ]
}